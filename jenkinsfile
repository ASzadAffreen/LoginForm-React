pipeline
{
    agent any;
    stages{
        stage("clone-code")
        {
            steps{
                git credentialsId: 'github',branch: 'main', url: 'https://github.com/ASzadAffreen/LoginForm-React.git'
            }
        }
        stage("docker-build")
        {
            steps{
                sh "docker build -t react-login-form ."
            }
        }
        stage("docker-push")
        {
            steps
            {
                withCredentials([string(credentialsId: 'dockerid', variable: 'dockerpwd')]) {
                sh "docker login -u mohammadaszadali -p ${dockerpwd}"
                sh "docker tag react-login-form:latest mohammadaszadali/react-login-form:latest"
                sh "docker push mohammadaszadali/react-login-form:latest"
}
            }
        }
        stage("Deploy")
        {
            steps {
                withKubeConfig(caCertificate: '', clusterName: '', contextName: '', credentialsId: 'kube', namespace: '', restrictKubeConfigAccess: false, serverUrl: 'https://56B049986CD4E2BBB7E8498192912684.gr7.us-east-1.eks.amazonaws.com') {
        sh "kubectl apply -f kube-deploy.yaml"
}
            }
        }
    }
}
